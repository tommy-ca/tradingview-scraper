# Specification: Strategy Synthesis (v1.1)

## 1. Objective
Enable the platform to optimize across not just assets, but **Synthesized Return Streams** generated by specific trading logic (Momentum, Mean Reversion, Trend Following).

## 2. The Strategy Atom Standard
A **Strategy Atom** is the fundamental unit of alpha, defined as a quartet:
`Atom = (Asset, AlphaLogic, Direction, TimeScale)`

- **Attribution Purity**: Each atom MUST have exactly ONE alpha logic.
- **Normalization**: SHORT atoms are inverted ($R_{syn} = -1 \times R_{raw}$) to ensure positive-alpha bias for solvers.
- **ID Pattern**: `{Asset}_{Logic}_{Direction}_{TimeScale}`

## 3. The 3-Pillar Integration Standard
Portfolio engines must treat these synthesized returns as "Primary Assets." 

### 3.1 Composite Returns
$R_{composite} = R_{raw} \times Signal_{logic} \times DirectionFactor$
Where $DirectionFactor$ is $1.0$ for LONG and $-1.0$ for SHORT.

### 3.2 Optimization Flow (Just-In-Time Architecture)
1. **Pillar 1 (Data)**: Ingest **Physical Returns** only (`returns_matrix.parquet`). No logic applied.
2. **Pillar 2 (Synthesis)**: Just-In-Time expansion of Physical Assets into Logic Atoms (`scripts/synthesize_strategy_matrix.py`).
    - Input: Physical Returns + Candidate Manifest (Logic/Direction).
    - Output: `synthetic_returns.parquet` (e.g. `BTC_trend_SHORT` with inverted returns).
3. **Pillar 3 (Allocation)**: Optimize across these **synthetic streams** using decision-naive solvers (`skfolio`, `riskfolio`).
4. **Execution Layer**: Aggregate weights back to physical assets for implementation.

## 4. Recursive Weight Flattening
To bridge the gap between abstract Strategy Optimization and physical asset execution, the platform implements a recursive aggregation chain.

### 4.1 The Weight Chain
1.  **Solver Layer (Pillar 3)**: Output is $w_{strat\_i}$, the weight of the $i$-th strategy stream.
2.  **Synthesis Layer (Pillar 2)**: Each stream $i$ maps to a set of underlying assets with logic-specific factors ($1.0$ or $-1.0$).
3.  **Physical Layer (Execution)**: The Orchestrator flattens these weights:
    $$Weight_{Asset,j} = \sum_i (w_{strat\_i} \times Factor_{asset\_j, i})$$

### 4.2 Weight Flattening Guard
The orchestrator implements a post-aggregation guard to verify that $\sum Weight_{Net}$ aligns with the target exposure ($0.0$ for Neutral, $1.0$ for Long-Only).
