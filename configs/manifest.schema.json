{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TradingView Scraper Workflow Manifest",
  "type": "object",
  "properties": {
    "default_profile": {
      "type": "string",
      "default": "production"
    },
    "profiles": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/profile"
      }
    }
  },
  "required": ["profiles"],
  "definitions": {
    "profile": {
      "type": "object",
      "properties": {
        "description": { "type": "string" },
        "data": {
          "type": "object",
          "properties": {
            "lookback_days": { "type": "integer", "minimum": 1 },
            "batch_size": { "type": "integer", "minimum": 1 },
            "backfill": { "type": "boolean" },
            "gapfill": { "type": "boolean" },
            "max_symbols": { "type": "integer", "minimum": 1 }
          }
        },
        "selection": {
          "type": "object",
          "properties": {
            "top_n": { "type": "integer", "minimum": 1 },
            "threshold": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        },
        "risk": {
          "type": "object",
          "properties": {
            "cluster_cap": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        },
        "backtest": {
          "type": "object",
          "properties": {
            "train_window": { "type": "integer", "minimum": 1 },
            "test_window": { "type": "integer", "minimum": 1 },
            "step_size": { "type": "integer", "minimum": 1 },
            "backtest_simulator": { "type": "string", "enum": ["custom", "cvxportfolio"] },
            "backtest_slippage": { "type": "number", "minimum": 0 },
            "backtest_commission": { "type": "number", "minimum": 0 },
            "backtest_cash_asset": { "type": "string" }
          }
        },
        "tournament": {
          "type": "object",
          "properties": {
            "engines": { "type": "string" },
            "profiles": { "type": "string" }
          }
        },
        "discovery": {
          "type": "object",
          "properties": {
            "enabled_markets": {
              "type": "array",
              "items": { "type": "string", "enum": ["futures", "crypto", "cfd", "forex", "bonds", "etf"] }
            }
          },
          "additionalProperties": {
            "type": "object",
            "properties": {
              "enabled": { "type": "boolean" },
              "base_preset": { "type": "string" },
              "limit": { "type": "integer" },
              "exchanges": { "type": "array", "items": { "type": "string" } }
            },
            "additionalProperties": true
          }
        },
        "env": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        }
      }
    }
  }
}
